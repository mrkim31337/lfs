pkgbuild_version=5
pkgname=mozjs2
_pkgname=mozjs
pkgver=24.2.0

dependencies=(
	"!$pkgname"
	'libffi'
	'nspr'
	'Python2'
	'zip'
)
sources=(
	"http://ftp.mozilla.org/pub/mozilla.org/js/${_pkgname}-${pkgver}.tar.bz2"
)
sha1sums=(
	7805174898c34e5d3c3b256117af9944ba825c89
)

lfs_me_prepare() {
	tar -xf "${sources_dir}/${_pkgname}-${pkgver}.tar.bz2" -C "$build_dir"

	cd "${build_dir}/${_pkgname}-${pkgver}"

	cd js/src 
	sed -i 's/(defined\((@TEMPLATE_FILE)\))/\1/' config/milestone.pl 
	./configure --prefix=/usr       \
	            --enable-readline   \
				--enable-threadsafe \
				--with-system-ffi   \
				--with-system-nspr
}

lfs_me_build() {
	cd "${build_dir}/${_pkgname}-${pkgver}/js/src"
	make
}

lfs_me_check() {
	cd "${build_dir}/${_pkgname}-${pkgver}/js/src"
	make check
}

lfs_me_install() {
	cd "${build_dir}/${_pkgname}-${pkgver}/js/src"
	make DESTDIR="$fakeroot_dir" install
}


lfs_me_postinstall(){
     find /usr/include/mozjs-24/         \
     /usr/lib/libmozjs-24.a         \
     /usr/lib/pkgconfig/mozjs-24.pc \
     -type f -exec chmod -v 644 {} \;

}
# vim:set ts=4 syntax=sh:
